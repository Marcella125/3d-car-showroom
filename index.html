<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lambo</title>
<style>
html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #000;
}
#container3D { width: 100%; height: 100%; }
</style>
</head>
<body>
<div id="container3D"></div>

<script type="module">
import * as THREE from "https://cdn.skypack.dev/three@0.129.0/build/three.module.js";
import { GLTFLoader } from "https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/GLTFLoader.js";
import { OrbitControls } from "https://cdn.skypack.dev/three@0.129.0/examples/jsm/controls/OrbitControls.js";
import { RGBELoader } from "https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/RGBELoader.js";
import { PMREMGenerator } from "https://cdn.skypack.dev/three@0.129.0/build/three.module.js";
import { EffectComposer } from "https://cdn.skypack.dev/three@0.129.0/examples/jsm/postprocessing/EffectComposer.js";
import { RenderPass } from "https://cdn.skypack.dev/three@0.129.0/examples/jsm/postprocessing/RenderPass.js";
import { UnrealBloomPass } from "https://cdn.skypack.dev/three@0.129.0/examples/jsm/postprocessing/UnrealBloomPass.js";
import { SMAAPass } from "https://cdn.skypack.dev/three@0.129.0/examples/jsm/postprocessing/SMAAPass.js";

// Scene & Camera
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(25, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(4, 2, 5);

// Renderer
const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true, powerPreference:"high-performance" });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
renderer.physicallyCorrectLights = true;
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
renderer.outputEncoding = THREE.sRGBEncoding;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 7;
document.getElementById("container3D").appendChild(renderer.domElement);

// Controls
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.07;
controls.maxPolarAngle = Math.PI/2.2;
controls.minDistance = 2;
controls.maxDistance = 15;
controls.autoRotate = true;
controls.autoRotateSpeed = 0.8;

// Lights
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const sun = new THREE.DirectionalLight(0xffffff,1);
sun.position.set(5,10,5);
sun.castShadow = true;
scene.add(sun);

// Floor
const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(20,20),
    new THREE.MeshStandardMaterial({color:0x333333, metalness:0.1, roughness:0.8})
);
floor.rotation.x = -Math.PI/2;
floor.position.y = 0;
floor.receiveShadow = true;
scene.add(floor);

// Postprocessing
const composer = new EffectComposer(renderer);
composer.addPass(new RenderPass(scene, camera));
composer.addPass(new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight),0.15,0.3,0.7));
composer.addPass(new SMAAPass(window.innerWidth, window.innerHeight));

const loader = new GLTFLoader();
loader.load("lambo/scene.gltf",
    (gltf)=>{
        const car = gltf.scene;
        const box = new THREE.Box3().setFromObject(car);
        const center = box.getCenter(new THREE.Vector3());
        const size = box.getSize(new THREE.Vector3());
        const scale = 2.5/Math.max(size.x,size.y,size.z);
        car.scale.setScalar(scale);
        car.position.sub(center);
        car.position.y = 0.05;

        car.traverse(c=>{
            if(c.isMesh && c.material){
                c.material.roughness=0.35;
                c.material.metalness=0.8;
                c.material.envMapIntensity=0.3;
                c.material.clearcoat=0.8;
                c.material.clearcoatRoughness=0.15;
                c.material.castShadow = true;
                c.material.receiveShadow = true;
            }
        });
        scene.add(car);
        controls.target.copy(car.position);
        controls.update();
    }
);

// Animate
function animate(){
    requestAnimationFrame(animate);
    controls.update();
    composer.render();
}

// Resize
window.addEventListener("resize",()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
    composer.setSize(window.innerWidth, window.innerHeight);
});

animate();
</script>
</body>
</html>
